<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸è·¯æ™ºæ˜Ÿ - é’å°‘å¹´ç§¯æœ¨ç¼–ç¨‹æ•™è‚²å¹³å°</title>
    <link rel="icon" type="image/png" href="assets/images/logo.png">
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .logo img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-links a {
            color: #333;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: #667eea;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.3s;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
        }
        
        /* ä¸»è¦å†…å®¹ */
        .main-content {
            margin-top: 80px;
            padding: 2rem;
        }
        
        .hero-section {
            text-align: center;
            padding: 4rem 1rem;
            color: white;
        }
        
        .hero-section h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero-section p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }
        
        /* ç¼–è¾‘å™¨å®¹å™¨ */
        .editor-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .editor-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .editor-controls {
            display: flex;
            gap: 1rem;
        }
        
        .control-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .editor-body {
            display: flex;
            height: 600px;
        }
        
        /* å·¦ä¾§ç´ æé¢æ¿ */
        .assets-panel {
            width: 250px;
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
        }
        
        .assets-header {
            padding: 1rem;
            background: #e9ecef;
            font-weight: bold;
            border-bottom: 1px solid #dee2e6;
        }
        
        .asset-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #dee2e6;
        }
        
        .asset-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            transition: background 0.3s;
        }
        
        .asset-tab:hover {
            background: #f8f9fa;
        }
        
        .asset-tab.active {
            background: #667eea;
            color: white;
        }
        
        .assets-grid {
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .asset-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .asset-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .asset-thumb {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .asset-thumb img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .asset-name {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* ä¸­é—´å·¥ä½œåŒº */
        .workspace {
            flex: 1;
            background: #fafafa;
            position: relative;
            overflow: hidden;
        }
        
        .workspace-canvas {
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(0deg, transparent 24%, rgba(0,0,0,.05) 25%, rgba(0,0,0,.05) 26%, transparent 27%, transparent 74%, rgba(0,0,0,.05) 75%, rgba(0,0,0,.05) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(0,0,0,.05) 25%, rgba(0,0,0,.05) 26%, transparent 27%, transparent 74%, rgba(0,0,0,.05) 75%, rgba(0,0,0,.05) 76%, transparent 77%, transparent);
            background-size: 30px 30px;
        }
        
        /* å³ä¾§èˆå° */
        .stage-panel {
            width: 480px;
            background: white;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }
        
        .stage-header {
            padding: 1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stage-viewer {
            flex: 1;
            background: white;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stage-canvas {
            width: 440px;
            height: 330px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            position: relative;
        }
        
        /* åº•éƒ¨æ§åˆ¶å° */
        .console-panel {
            background: #2d3436;
            color: #dfe6e9;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .console-line {
            margin-bottom: 0.5rem;
        }
        
        .console-line.info { color: #74b9ff; }
        .console-line.success { color: #55efc4; }
        .console-line.warning { color: #fdcb6e; }
        .console-line.error { color: #ff7675; }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .loader.active {
            display: block;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero-section h1 {
                font-size: 2rem;
            }
            
            .editor-body {
                flex-direction: column;
                height: auto;
            }
            
            .assets-panel,
            .stage-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="assets/images/logo.png" alt="ä¸è·¯æ™ºæ˜Ÿ">
                <span>ä¸è·¯æ™ºæ˜Ÿ</span>
            </div>
            <div class="nav-links">
                <a href="#home">é¦–é¡µ</a>
                <a href="#courses">è¯¾ç¨‹</a>
                <a href="#projects">ä½œå“</a>
                <a href="#community">ç¤¾åŒº</a>
                <a href="#about">å…³äº</a>
            </div>
            <button class="start-btn" onclick="startEditor()">å¼€å§‹åˆ›ä½œ</button>
        </div>
    </nav>
    
    <!-- ä¸»è¦å†…å®¹ -->
    <div class="main-content">
        <div class="hero-section">
            <h1>ä¸è·¯æ™ºæ˜Ÿç¼–ç¨‹å¹³å°</h1>
            <p>è®©æ¯ä¸ªå­©å­éƒ½èƒ½è½»æ¾å­¦ä¹ ç¼–ç¨‹ï¼Œåˆ›é€ æ— é™å¯èƒ½</p>
        </div>
        
        <!-- ç¼–è¾‘å™¨ -->
        <div class="editor-container">
            <div class="editor-header">
                <div class="editor-title">ç§¯æœ¨ç¼–ç¨‹ç¼–è¾‘å™¨</div>
                <div class="editor-controls">
                    <button class="control-btn" onclick="saveProject()">ä¿å­˜</button>
                    <button class="control-btn" onclick="loadProject()">åŠ è½½</button>
                    <button class="control-btn" onclick="shareProject()">åˆ†äº«</button>
                    <button class="control-btn" onclick="runCode()">â–¶ è¿è¡Œ</button>
                </div>
            </div>
            
            <div class="editor-body">
                <!-- ç´ æé¢æ¿ -->
                <div class="assets-panel">
                    <div class="assets-header">ç´ æåº“</div>
                    <div class="asset-tabs">
                        <button class="asset-tab active" onclick="showAssets('sprites')">ç²¾çµ</button>
                        <button class="asset-tab" onclick="showAssets('backdrops')">èƒŒæ™¯</button>
                        <button class="asset-tab" onclick="showAssets('sounds')">å£°éŸ³</button>
                    </div>
                    <div class="assets-grid" id="assetsGrid">
                        <!-- ç´ æå°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                        <div class="asset-item">
                            <div class="asset-thumb">ğŸ±</div>
                            <div class="asset-name">å°çŒ«</div>
                        </div>
                        <div class="asset-item">
                            <div class="asset-thumb">ğŸ¶</div>
                            <div class="asset-name">å°ç‹—</div>
                        </div>
                        <div class="asset-item">
                            <div class="asset-thumb">ğŸ¦‹</div>
                            <div class="asset-name">è´è¶</div>
                        </div>
                        <div class="asset-item">
                            <div class="asset-thumb">ğŸš—</div>
                            <div class="asset-name">æ±½è½¦</div>
                        </div>
                    </div>
                </div>
                
                <!-- å·¥ä½œåŒº -->
                <div class="workspace">
                    <div class="workspace-canvas" id="workspaceCanvas">
                        <!-- Blocklyæˆ–è‡ªå®šä¹‰ç§¯æœ¨ç¼–è¾‘å™¨å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
                    </div>
                </div>
                
                <!-- èˆå° -->
                <div class="stage-panel">
                    <div class="stage-header">
                        <span>èˆå°</span>
                        <button class="control-btn" onclick="resetStage()">é‡ç½®</button>
                    </div>
                    <div class="stage-viewer">
                        <div class="stage-canvas" id="stageCanvas">
                            <!-- èˆå°å†…å®¹ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ§åˆ¶å° -->
            <div class="console-panel" id="console">
                <div class="console-line info">ğŸ¯ ç³»ç»Ÿå°±ç»ªï¼Œæ¬¢è¿ä½¿ç”¨ä¸è·¯æ™ºæ˜Ÿç¼–ç¨‹å¹³å°ï¼</div>
                <div class="console-line success">âœ… ç´ æåº“åŠ è½½å®Œæˆ</div>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>
    
    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="js/MediaLibrary.js"></script>
    <script src="ai-assistant.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let mediaLibrary = null;
        let currentAssetType = 'sprites';
        
        // åˆå§‹åŒ–åª’ä½“åº“
        async function initMediaLibrary() {
            console.log('å¼€å§‹åŠ è½½ç´ æåº“...');
            mediaLibrary = new MediaLibrary();
            
            try {
                await mediaLibrary.init(2); // ä½¿ç”¨Scratch 2ç´ æ
                
                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                const stats = {
                    sprites: mediaLibrary.getSprites().length,
                    costumes: mediaLibrary.getCostumes().length,
                    backdrops: mediaLibrary.getBackdrops().length,
                    sounds: mediaLibrary.getSounds().length
                };
                
                addConsoleLog(`ç´ æç»Ÿè®¡ - ç²¾çµ: ${stats.sprites}ä¸ª, é€ å‹: ${stats.costumes}ä¸ª, èƒŒæ™¯: ${stats.backdrops}ä¸ª, å£°éŸ³: ${stats.sounds}ä¸ª`, 'success');
                
                // æ˜¾ç¤ºé»˜è®¤ç´ æ
                showAssets('sprites');
                
            } catch (error) {
                console.error('ç´ æåº“åŠ è½½å¤±è´¥:', error);
                addConsoleLog('ç´ æåº“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ç´ æ', 'warning');
            }
        }
        
        // æ˜¾ç¤ºç´ æ
        function showAssets(type) {
            currentAssetType = type;
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.asset-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // è·å–ç´ æ
            let assets = [];
            switch(type) {
                case 'sprites':
                    assets = mediaLibrary ? mediaLibrary.getSprites().slice(0, 20) : [];
                    break;
                case 'backdrops':
                    assets = mediaLibrary ? mediaLibrary.getBackdrops().slice(0, 20) : [];
                    break;
                case 'sounds':
                    assets = mediaLibrary ? mediaLibrary.getSounds().slice(0, 20) : [];
                    break;
            }
            
            // æ›´æ–°ç´ æç½‘æ ¼
            const grid = document.getElementById('assetsGrid');
            grid.innerHTML = '';
            
            if (assets.length === 0) {
                // æ˜¾ç¤ºé»˜è®¤ç´ æ
                const defaultAssets = getDefaultAssets(type);
                defaultAssets.forEach(asset => {
                    const item = createAssetItem(asset);
                    grid.appendChild(item);
                });
            } else {
                // æ˜¾ç¤ºçœŸå®ç´ æ
                assets.forEach(asset => {
                    const item = createAssetItem(asset, type);
                    grid.appendChild(item);
                });
            }
            
            addConsoleLog(`åˆ‡æ¢åˆ°${type === 'sprites' ? 'ç²¾çµ' : type === 'backdrops' ? 'èƒŒæ™¯' : 'å£°éŸ³'}ç´ æ`, 'info');
        }
        
        // åˆ›å»ºç´ æé¡¹
        function createAssetItem(asset, type) {
            const item = document.createElement('div');
            item.className = 'asset-item';
            
            const thumb = document.createElement('div');
            thumb.className = 'asset-thumb';
            
            if (type === 'sounds' || asset.type === 'sound') {
                thumb.innerHTML = 'ğŸµ';
            } else if (asset.md5 && mediaLibrary) {
                const img = document.createElement('img');
                img.src = mediaLibrary.getThumbnailUrl(asset.md5);
                img.onerror = () => {
                    img.src = mediaLibrary.getAssetUrl(asset.md5);
                    img.onerror = () => {
                        thumb.innerHTML = asset.icon || 'ğŸ“¦';
                    };
                };
                thumb.appendChild(img);
            } else {
                thumb.innerHTML = asset.icon || 'ğŸ“¦';
            }
            
            const name = document.createElement('div');
            name.className = 'asset-name';
            name.textContent = asset.name || 'Unnamed';
            
            item.appendChild(thumb);
            item.appendChild(name);
            
            item.onclick = () => selectAsset(asset);
            
            return item;
        }
        
        // è·å–é»˜è®¤ç´ æ
        function getDefaultAssets(type) {
            const defaults = {
                sprites: [
                    { name: 'å°çŒ«', icon: 'ğŸ±' },
                    { name: 'å°ç‹—', icon: 'ğŸ¶' },
                    { name: 'è´è¶', icon: 'ğŸ¦‹' },
                    { name: 'æ±½è½¦', icon: 'ğŸš—' },
                    { name: 'é£æœº', icon: 'âœˆï¸' },
                    { name: 'æœºå™¨äºº', icon: 'ğŸ¤–' }
                ],
                backdrops: [
                    { name: 'è“å¤©', icon: 'â˜ï¸' },
                    { name: 'æ£®æ—', icon: 'ğŸŒ²' },
                    { name: 'åŸå¸‚', icon: 'ğŸ™ï¸' },
                    { name: 'å¤ªç©º', icon: 'ğŸŒŒ' },
                    { name: 'æµ·æ´‹', icon: 'ğŸŒŠ' },
                    { name: 'æ²™æ¼ ', icon: 'ğŸœï¸' }
                ],
                sounds: [
                    { name: 'å–µå–µ', icon: 'ğŸµ' },
                    { name: 'æ±ªæ±ª', icon: 'ğŸµ' },
                    { name: 'é’¢ç´', icon: 'ğŸ¹' },
                    { name: 'é¼“å£°', icon: 'ğŸ¥' },
                    { name: 'æŒå£°', icon: 'ğŸ‘' },
                    { name: 'ç¬‘å£°', icon: 'ğŸ˜„' }
                ]
            };
            
            return defaults[type] || [];
        }
        
        // é€‰æ‹©ç´ æ
        function selectAsset(asset) {
            addConsoleLog(`é€‰æ‹©äº†ç´ æ: ${asset.name}`, 'info');
            // TODO: å°†ç´ ææ·»åŠ åˆ°å·¥ä½œåŒº
        }
        
        // æ·»åŠ æ§åˆ¶å°æ—¥å¿—
        function addConsoleLog(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            
            const icons = {
                info: 'ğŸ¯',
                success: 'âœ…',
                warning: 'âš ï¸',
                error: 'âŒ'
            };
            
            line.textContent = `${icons[type] || ''} ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }
        
        // ç¼–è¾‘å™¨åŠŸèƒ½
        function startEditor() {
            addConsoleLog('å¯åŠ¨ç¼–è¾‘å™¨', 'success');
            document.querySelector('.editor-container').scrollIntoView({ behavior: 'smooth' });
        }
        
        function saveProject() {
            addConsoleLog('ä¿å­˜é¡¹ç›®...', 'info');
            // TODO: å®ç°ä¿å­˜åŠŸèƒ½
            setTimeout(() => {
                addConsoleLog('é¡¹ç›®å·²ä¿å­˜', 'success');
            }, 1000);
        }
        
        function loadProject() {
            addConsoleLog('åŠ è½½é¡¹ç›®...', 'info');
            // TODO: å®ç°åŠ è½½åŠŸèƒ½
        }
        
        function shareProject() {
            addConsoleLog('åˆ†äº«é¡¹ç›®...', 'info');
            // TODO: å®ç°åˆ†äº«åŠŸèƒ½
        }
        
        function runCode() {
            addConsoleLog('è¿è¡Œä»£ç ...', 'info');
            // TODO: å®ç°è¿è¡ŒåŠŸèƒ½
            setTimeout(() => {
                addConsoleLog('ä»£ç æ‰§è¡Œå®Œæˆ', 'success');
            }, 1500);
        }
        
        function resetStage() {
            addConsoleLog('é‡ç½®èˆå°', 'info');
            // TODO: å®ç°é‡ç½®åŠŸèƒ½
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            addConsoleLog('ç³»ç»Ÿåˆå§‹åŒ–ä¸­...', 'info');
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            document.getElementById('loader').classList.add('active');
            
            // åˆå§‹åŒ–ç´ æåº“
            await initMediaLibrary();
            
            // åˆå§‹åŒ–AIåŠ©æ‰‹
            if (window.AIAssistant) {
                window.aiAssistant = new AIAssistant();
                addConsoleLog('AIåŠ©æ‰‹å·²å°±ç»ª', 'success');
            }
            
            // éšè—åŠ è½½åŠ¨ç”»
            document.getElementById('loader').classList.remove('active');
            
            addConsoleLog('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥å¼€å§‹åˆ›ä½œäº†ï¼', 'success');
        });
    </script>
</body>
</html>
